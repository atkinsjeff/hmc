"0","# loading the required packages"
"0","library(ggplot2)"
"0","require(plyr)"
"0","require(dplyr)"
"0","require(tidyverse)"
"0","require(ggforce)"
"0","require(splitstackshape)"
"0","require(data.table)"
"0","library(forcats)"
"0","require(ggridges)"
"0","# The palette with black:"
"0","cbbPalette <-c(""#1b9e77"", ""#d95f02"", ""#7570b3"", ""#e7298a"", ""#66a61e"", ""#e6ab02"", ""#a6761d"", ""#666666"")"
"0","#bring in inventory data"
"0","#set data directory"
"0","data_dir <- ""./data/inventory/"""
"0","#merge a bunch of .csvs"
"0","multmerge = function(path){"
"0","  filenames=list.files(path=path, full.names=TRUE)"
"0","  rbindlist(lapply(filenames, fread))"
"0","}"
"0","#importing all the data"
"0","inventory <- multmerge(data_dir)"
"0","#convert to data frame"
"0","inventory <- as(inventory, ""data.frame"")"
"0","#remove empty lines from haglof"
"0","inventory <- na.omit(inventory, cols = ""Tag"")"
"0","#adding subplot"
"0","source(""./code/addNewData.r"")"
"0","allowedVars <- c(""PlotID"")"
"0","#add subplot"
"0","df <- addNewData(""./data/inventory_lookup_table.csv"", inventory, allowedVars)"
"0","# cleaning up df"
"0","# names(df)[names(df) == ""DBH_cm""] <- ""dbh"""
"0","# df$dbh <- as.numeric(df$dbh)"
"0","# df$SubplotID <- as.factor(df$SubplotID)"
"0","# df$Species <- as.factor(df$Species)"
"0","# merge with spatial data"
"0","# using plot A01W"
"0","data_dir <- ""./data/haglof/"""
"0","#import all the .csv files"
"0","spatial.data <- multmerge(data_dir)"
"0","# make a data frame"
"0","spatial.data <- as(spatial.data, ""data.frame"")"
"0","#rename columns"
"0","names(spatial.data)[1] <- ""Subplot"""
"0","names(spatial.data)[2] <- ""Plot_Radius"""
"0","names(spatial.data)[3] <- ""Tag"""
"0","names(spatial.data)[4] <- ""Tree_Spc"""
"0","names(spatial.data)[5] <- ""Tree_Dia"""
"0","names(spatial.data)[6] <- ""Tree_Hgt"""
"0","names(spatial.data)[7] <- ""Tree_PosTex1"""
"0","names(spatial.data)[8] <- ""Tree_PosTex2"""
"0","names(spatial.data)[9] <- ""Tree_PosTex3"""
"0","names(spatial.data)[10] <- ""Tree_Local_x"""
"0","names(spatial.data)[11] <- ""Tree_Local_y"""
"0","names(spatial.data)[12] <- ""Tree_Local_Dist"""
"0","names(spatial.data)[13] <- ""Tree_Local_Angle"""
"0","names(spatial.data)[14] <- ""Tree_Angle_ToPlotCenter"""
"0","names(spatial.data)[15] <- ""Latitude"""
"0","names(spatial.data)[16] <- ""Longitude"""
"0","names(spatial.data)[17] <- ""Tree_Nr"""
"0","spatial.data %>%"
"0","  select(""Subplot"", ""Tag"", ""Tree_Dia"", ""Latitude"", ""Longitude"") %>%"
"0","  mutate(dbh = Tree_Dia*0.1) -> jim"
"0","#merging"
"0","stem <-  merge(df, jim, all.x = TRUE)"
"0","# cleaning up missing data"
"0","# stem$Species[stem$Species == ""FAGR#""] <- ""FAGR"""
"0","# stem$Species[stem$Species == ""POGR ?""] <- ""POGR"""
"0","# stem$Species[stem$Species == ""TSCA ?""] <- ""TSCA"""
"0","# stem$Species[stem$Species == ""?""] <- ""unknown"""
"0","# stem$Species[stem$Species == ""UNKNOWN""] <- ""unknown"""
"0","# stem$Species[stem$Species == ""QUR""] <- ""QURU"""
"0","# stem$Species[stem$Species == ""ADRU""] <- ""ACRU"""
"0","#"
"0","stem <- subset(stem, Species != ""SNAG"")"
"0","#"
"0","#bring in conversion to leaf area"
"0","allo.df <- read.csv(""./data/dbh_to_leaf_area_conversions.csv"")"
"0","allo.df %>%"
"0","  filter(component == ""FL"") -> allo.fl"
"0","stem <- merge(stem, allo.fl)"
"0","stem$leaf.mass <- stem$a * (stem$dbh^stem$b)"
"0","stem <- droplevels(stem)"
"0","attach(stem)"
"0","stem$genus[stem$Species == ""ACPE""] <- ""Acer"""
"0","stem$genus[stem$Species == ""ACRU""] <- ""Acer"""
"0","stem$genus[stem$Species == ""ACSA""] <- ""Acer"""
"0","stem$genus[stem$Species == ""BEPA""] <- ""Betula"""
"0","stem$genus[stem$Species == ""PIRE""] <- ""Pinus"""
"0","stem$genus[stem$Species == ""PIST""] <- ""Pinus"""
"0","stem$genus[stem$Species == ""QURU""] <- ""Quercus"""
"0","stem$genus[stem$Species == ""AMEL""] <- ""Other"""
"0","stem$genus[stem$Species == ""TSCA""] <- ""Tsuga"""
"0","stem$genus[stem$Species == ""FAGR""] <- ""Fagus"""
"0","stem$genus[stem$Species == ""POGR""] <- ""Populus"""
"0","stem$genus[stem$Species == ""POTR""] <- ""Populus"""
"0","stem$genus[stem$Species == ""unknown""] <- ""Other"""
"0","stem$genus <- as.factor(stem$genus)"
"0","attach(stem)"
"0","stem$sla[stem$genus == ""Acer""] <- 19"
"0","stem$sla[stem$genus == ""Betula""] <- 20.82"
"0","stem$sla[stem$genus == ""Pinus""] <- 8.12"
"0","stem$sla[stem$genus == ""Quercus""] <- 14.2"
"0","stem$sla[stem$genus == ""Other""] <- 19"
"0","stem$sla[stem$genus == ""Tsuga""] <- 5.84"
"0","stem$sla[stem$genus == ""Fagus""] <- 35"
"0","stem$sla[stem$genus == ""Populus""] <- 15.89"
"0","stem$lai <- stem$leaf.mass * stem$sla"
